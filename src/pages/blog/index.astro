---
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import { Image } from 'astro:assets';
import Container from '../../components/Container.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <!-- Page Header -->
  <section
    class="bg-gradient-to-b from-stone-100/80 to-stone-50 border-b border-stone-200/50 py-6 md:py-10 construction-grid"
  >
    <Container>
      <header class="text-center">
        <h1
          class="text-3xl md:text-4xl font-bold tracking-tight text-stone-800"
        >
          Blog
        </h1>
        <p class="text-stone-500 text-lg mt-3">
          Projects, recipes, and things I've built
        </p>
      </header>
    </Container>
  </section>

  <section class="py-8 md:py-12 bg-white construction-grid">
    <Container>
      <!-- Posts Grid -->
      <ul class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          posts.map((post, index) => (
            <li class="reveal" style={`--reveal-delay: ${index * 80}ms`}>
              <a href={`/blog/${post.id}/`} class="group block h-full">
                <article class="h-full flex flex-col">
                  {post.data.heroImage ? (
                    <div class="overflow-hidden rounded-lg mb-4 aspect-[4/3] image-grain image-copper-hover">
                      <Image
                        width={600}
                        height={450}
                        src={post.data.heroImage}
                        alt=""
                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                      />
                    </div>
                  ) : (
                    <div class="rounded-lg mb-4 aspect-[4/3] bg-gradient-to-br from-stone-100 to-stone-200/50 flex items-center justify-center">
                      <span class="text-4xl opacity-50">
                        {post.data.tags?.[0] === 'code'
                          ? 'üíª'
                          : post.data.tags?.[0] === 'cooking'
                            ? 'üç≥'
                            : 'üìù'}
                      </span>
                    </div>
                  )}
                  <div class="flex-1 flex flex-col">
                    <h3 class="text-lg font-semibold text-stone-800 group-hover:text-[var(--color-copper-dark)] transition-colors leading-snug">
                      {post.data.title}
                    </h3>
                    {post.data.description && (
                      <p class="mt-2 text-stone-600 text-sm line-clamp-2 flex-1">
                        {post.data.description}
                      </p>
                    )}
                    <div class="mt-3 flex items-center gap-2 text-sm text-stone-500">
                      <FormattedDate date={post.data.pubDate} pill={false} />
                      {post.data.tags && post.data.tags.length > 0 && (
                        <>
                          <span>¬∑</span>
                          <span class="text-[var(--color-copper)]">
                            {post.data.tags[0]}
                          </span>
                        </>
                      )}
                    </div>
                  </div>
                </article>
              </a>
            </li>
          ))
        }
      </ul>
    </Container>
  </section>

  <script src="../../scripts/reveal.ts"></script>
</BaseLayout>
