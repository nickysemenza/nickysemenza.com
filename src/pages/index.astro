---
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import Container from "../components/Container.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

const blogPosts = await getCollection("blog");

const featuredProjectsConfig = [
  { title: "Kitchen Renovation", subtitle: "2024", slug: "kitchen-renovation" },
  // { title: "Backyard Renovation", subtitle: "2025", slug: "backyard-renovation" },
];

const featuredProjects = featuredProjectsConfig
  .map((project) => {
    const post = blogPosts.find((p) => p.id === project.slug);
    if (!post?.data.heroImage) return null;
    return {
      ...project,
      description: post.data.description,
      link: `/blog/${project.slug}/`,
      image: post.data.heroImage,
    };
  })
  .filter((p) => p !== null);

const otherWork = [
  {
    emoji: "‚òÅÔ∏è",
    title: "Cloudflare",
    description: "Senior software engineer building distributed systems",
    year: "2018 - present",
  },
  {
    emoji: "ü•ï",
    title: "Ingredient Parser",
    description: "Rust-based NLP for recipe parsing",
    link: "https://ingredient.nickysemenza.com",
    external: true,
    year: "2021 - present",
  },
  {
    emoji: "üì∏",
    title: "Photography",
    description: "Editorial and food photography",
    link: "https://nicky.photos",
    external: true,
    year: "2013 - 2018",
  },
];

// Split text into letters for animation
const heroName = "Nicky";
const heroGreeting = "Hi, I'm";
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <!-- Hero Section -->
  <section
    class="relative bg-gradient-to-b from-stone-100/80 to-stone-50 border-b border-stone-200/50 construction-grid overflow-hidden"
  >
    <Container>
      <div class="py-12 sm:py-16 md:py-24 relative">
        <div class="max-w-3xl">
          <!-- Tagline -->
          <div class="mb-3">
            <span
              class="text-sm font-medium tracking-[0.2em] uppercase text-[var(--color-copper)]"
            >
              Builder ¬∑ Maker ¬∑ Engineer
            </span>
          </div>
          <!-- Dramatic hero typography -->
          <h1
            class="text-4xl sm:text-5xl md:text-6xl font-bold text-stone-800 tracking-tight leading-[0.95]"
            style="perspective: 1000px;"
          >
            <span class="block">
              {
                heroGreeting.split("").map((char, i) => (
                  <span
                    class="hero-letter"
                    style={`animation-delay: ${i * 50}ms`}
                  >
                    {char === " " ? "\u00A0" : char}
                  </span>
                ))
              }
            </span>
            <span class="block text-[var(--color-copper)]">
              {
                heroName.split("").map((char, i) => (
                  <span
                    class="hero-letter"
                    style={`animation-delay: ${(i + heroGreeting.length) * 50}ms`}
                  >
                    {char}
                  </span>
                ))
              }
            </span>
          </h1>
          <div class="hero-line mt-6 max-w-[200px]"></div>
          <p
            class="mt-6 text-lg sm:text-xl text-stone-600 max-w-xl animate-fade-up"
            style="animation-delay: 600ms;"
          >
            I build things with my hands and with code. Currently renovating an
            1886 Victorian in San Francisco.
          </p>
          <div
            class="mt-8 flex flex-wrap gap-4 animate-fade-up"
            style="animation-delay: 700ms;"
          >
            <a
              href="/blog"
              class="group inline-flex items-center gap-2 px-5 py-2.5 bg-stone-800 hover:bg-stone-900 text-white text-sm rounded-lg transition-all duration-300 font-medium hover:shadow-xl hover:-translate-y-0.5"
            >
              Read the blog
              <Icon
                name="tabler:arrow-right"
                class="w-4 h-4 transition-transform group-hover:translate-x-1"
              />
            </a>
            <a
              href="/about"
              class="inline-flex items-center gap-2 px-5 py-2.5 bg-white hover:bg-stone-50 text-stone-700 text-sm rounded-lg transition-all duration-300 font-medium border border-stone-200 hover:border-[var(--color-copper)] hover:shadow-lg hover:-translate-y-0.5"
            >
              About me
            </a>
          </div>
        </div>
      </div>
    </Container>
  </section>

  <!-- Featured Projects -->
  <section class="py-12 sm:py-16 md:py-20 bg-white construction-grid">
    <Container>
      <div class="grid md:grid-cols-2 gap-6 sm:gap-8">
        {
          featuredProjects.map((project, index) => (
            <a
              href={project.link}
              class="group block reveal reveal-scale"
              style={`--reveal-delay: ${index * 100}ms`}
            >
              <article class="relative rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 image-grain">
                <div class="aspect-[4/3] overflow-hidden">
                  <Image
                    src={project.image}
                    alt={project.title}
                    widths={[400, 600, 800]}
                    sizes="(max-width: 768px) 100vw, 50vw"
                    loading={index === 0 ? "eager" : "lazy"}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700 ease-out"
                  />
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent pointer-events-none" style="z-index: 4;" />
                <div class="absolute bottom-0 left-0 right-0 p-4 sm:p-6 text-white" style="z-index: 5;">
                  <p class="text-xs sm:text-sm font-medium text-[var(--color-copper-light)] mb-1">
                    {project.subtitle}
                  </p>
                  <h3 class="text-xl sm:text-2xl font-bold tracking-tight">
                    {project.title}
                  </h3>
                  <p class="mt-1 text-white/80 text-xs sm:text-sm">
                    {project.description}
                  </p>
                </div>
              </article>
            </a>
          ))
        }
      </div>

      <!-- Other Work -->
      <div class="mt-10 sm:mt-16">
        <div class="grid sm:grid-cols-3 gap-4 sm:gap-5">
          {
            otherWork.map((item, index) => (
              <div
                class="group relative bg-gradient-to-br from-stone-50 to-stone-100/60 rounded-xl p-5 sm:p-6 border border-stone-200/60 hover:border-[var(--color-copper)]/40 hover:shadow-lg hover:shadow-[var(--color-copper)]/10 transition-all duration-300 hover:-translate-y-1 reveal"
                style={`--reveal-delay: ${(index + 2) * 100}ms`}
              >
                {item.link ? (
                  <a
                    href={item.link}
                    target={item.external ? "_blank" : undefined}
                    rel={item.external ? "noopener noreferrer" : undefined}
                    class="block"
                  >
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-2xl">{item.emoji}</span>
                      <span class="text-xs font-medium text-[var(--color-copper)]">
                        {item.year}
                      </span>
                    </div>
                    <h4 class="text-lg font-semibold text-stone-800 group-hover:text-[var(--color-copper-dark)] transition-colors flex items-center gap-1.5">
                      {item.title}
                      {item.external && (
                        <Icon
                          name="tabler:external-link"
                          class="w-4 h-4 opacity-40"
                        />
                      )}
                    </h4>
                    <p class="mt-2 text-sm text-stone-600 leading-relaxed">
                      {item.description}
                    </p>
                  </a>
                ) : (
                  <>
                    <div class="flex items-center justify-between mb-3">
                      <span class="text-2xl">{item.emoji}</span>
                      <span class="text-xs font-medium text-[var(--color-copper)]">
                        {item.year}
                      </span>
                    </div>
                    <h4 class="text-lg font-semibold text-stone-800">
                      {item.title}
                    </h4>
                    <p class="mt-2 text-sm text-stone-600 leading-relaxed">
                      {item.description}
                    </p>
                  </>
                )}
              </div>
            ))
          }
        </div>
      </div>
    </Container>
  </section>

  <!-- Photos Section -->
  <section class="py-12 sm:py-16 bg-stone-800">
    <Container>
      <div
        class="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6 sm:mb-8 reveal"
      >
        <div>
          <h2
            class="text-xs sm:text-sm font-semibold text-[var(--color-copper-light)] uppercase tracking-wider mb-1 sm:mb-2"
          >
            Photography
          </h2>
          <p class="text-xl sm:text-2xl font-bold text-white">Recent photos</p>
        </div>
        <a
          href="https://nicky.photos"
          target="_blank"
          rel="noopener noreferrer"
          class="text-sm font-medium text-stone-400 hover:text-[var(--color-copper-light)] transition-colors duration-200 flex items-center gap-1"
        >
          View portfolio
          <Icon name="tabler:external-link" class="w-4 h-4" />
        </a>
      </div>
      <div class="rounded-xl overflow-hidden shadow-2xl reveal reveal-scale">
        <iframe
          src="https://www.nicky.photos/frame/slideshow?key=wXtF6f&autoStart=1&captions=1&navigation=1&playButton=0&randomize=1&speed=2&transition=fade&transitionSpeed=1"
          width="100%"
          height="400"
          class="sm:h-[500px] bg-stone-900"
          loading="lazy"
          title="Featured photos slideshow from nicky.photos"></iframe>
      </div>
    </Container>
  </section>

  <script src="../scripts/reveal.ts"></script>
</BaseLayout>
