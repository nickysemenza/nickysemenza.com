---
import { SITE_TITLE, SITE_DESCRIPTION } from '@/consts';
import Container from '@/components/Container.astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProjectCard from '@/components/ProjectCard.astro';
import { Icon } from 'astro-icon/components';
import { getAllProjects, getProjectBySlug } from '@/lib/projects';

const allProjects = await getAllProjects();

// Curated featured projects (large cards)
const featuredProjectsSlugs = ['kitchen-renovation', 'ingredient-parser'];
const featuredProjects = featuredProjectsSlugs
  .map((slug) => getProjectBySlug(allProjects, slug))
  .filter((p) => p !== undefined);

// Curated other work (compact cards)
const otherWorkSlugs = ['cloudflare', 'half-bath', 'shoe-rack'];
const otherWork = otherWorkSlugs
  .map((slug) => getProjectBySlug(allProjects, slug))
  .filter((p) => p !== undefined);

// Split text into letters for animation
const heroName = 'Nicky';
const heroGreeting = "Hi, I'm";
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <!-- Hero Section -->
  <section
    class="relative bg-gradient-to-b from-stone-100/80 to-stone-50 border-b border-stone-200/50 construction-grid overflow-hidden"
  >
    <Container>
      <div class="py-12 sm:py-16 md:py-24 relative">
        <div class="max-w-3xl">
          <!-- Tagline -->
          <div class="mb-3">
            <span
              class="text-sm font-medium tracking-[0.2em] uppercase text-[var(--color-copper)]"
            >
              Builder · Maker · Engineer
            </span>
          </div>
          <!-- Dramatic hero typography -->
          <h1
            class="text-4xl sm:text-5xl md:text-6xl font-bold text-stone-800 tracking-tight leading-[0.95]"
            style="perspective: 1000px;"
          >
            <span class="block">
              {
                heroGreeting.split('').map((char, i) => (
                  <span
                    class="hero-letter"
                    style={`animation-delay: ${i * 50}ms`}
                  >
                    {char === ' ' ? '\u00A0' : char}
                  </span>
                ))
              }
            </span>
            <span class="block text-[var(--color-copper)]">
              {
                heroName.split('').map((char, i) => (
                  <span
                    class="hero-letter"
                    style={`animation-delay: ${(i + heroGreeting.length) * 50}ms`}
                  >
                    {char}
                  </span>
                ))
              }
            </span>
          </h1>
          <div class="hero-line mt-6 max-w-[200px]"></div>
          <p
            class="mt-6 text-lg sm:text-xl text-stone-600 max-w-xl animate-fade-up"
            style="animation-delay: 600ms;"
          >
            I build things with my hands and with code. Currently renovating an
            1886 Victorian in San Francisco.
          </p>
          <div
            class="mt-8 flex flex-wrap gap-4 animate-fade-up"
            style="animation-delay: 700ms;"
          >
            <a
              href="/projects"
              class="group inline-flex items-center gap-2 px-5 py-2.5 bg-stone-800 hover:bg-stone-900 text-white text-sm rounded-lg transition-all duration-300 font-medium hover:shadow-xl hover:-translate-y-0.5"
            >
              View projects
              <Icon
                name="tabler:arrow-right"
                class="w-4 h-4 transition-transform group-hover:translate-x-1"
              />
            </a>
            <a
              href="/about"
              class="inline-flex items-center gap-2 px-5 py-2.5 bg-white hover:bg-stone-50 text-stone-700 text-sm rounded-lg transition-all duration-300 font-medium border border-stone-200 hover:border-[var(--color-copper)] hover:shadow-lg hover:-translate-y-0.5"
            >
              About me
            </a>
          </div>
        </div>
      </div>
    </Container>
  </section>

  <!-- Featured Projects -->
  <section class="py-12 sm:py-16 md:py-20 bg-white construction-grid">
    <Container>
      <div class="grid md:grid-cols-2 gap-6 sm:gap-8">
        {
          featuredProjects.map((project, index) => (
            <div
              class="reveal reveal-scale"
              style={`--reveal-delay: ${index * 100}ms`}
            >
              <ProjectCard
                project={project}
                variant="featured"
                loading={index === 0 ? 'eager' : 'lazy'}
              />
            </div>
          ))
        }
      </div>

      <!-- Other Work -->
      <div class="mt-10 sm:mt-16">
        <div class="grid sm:grid-cols-3 gap-4 sm:gap-5">
          {
            otherWork.map((project, index) => (
              <div
                class="reveal"
                style={`--reveal-delay: ${(index + 2) * 100}ms`}
              >
                <ProjectCard project={project} variant="compact" />
              </div>
            ))
          }
        </div>
        <div class="mt-8 text-center">
          <a
            href="/projects"
            class="inline-flex items-center gap-2 text-sm font-medium text-stone-600 hover:text-[var(--color-copper)] transition-colors"
          >
            View all projects
            <Icon name="tabler:arrow-right" class="w-4 h-4" />
          </a>
        </div>
      </div>
    </Container>
  </section>

  <!-- Photos Section -->
  <section class="py-12 sm:py-16 bg-stone-800">
    <Container>
      <div
        class="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6 sm:mb-8 reveal"
      >
        <div>
          <h2
            class="text-xs sm:text-sm font-semibold text-[var(--color-copper-light)] uppercase tracking-wider mb-1 sm:mb-2"
          >
            Photography
          </h2>
          <p class="text-xl sm:text-2xl font-bold text-white">Recent photos</p>
        </div>
        <a
          href="https://nicky.photos"
          target="_blank"
          rel="noopener noreferrer"
          class="text-sm font-medium text-stone-400 hover:text-[var(--color-copper-light)] transition-colors duration-200 flex items-center gap-1"
        >
          View portfolio
          <Icon name="tabler:external-link" class="w-4 h-4" />
        </a>
      </div>
      <div class="rounded-xl overflow-hidden shadow-2xl reveal reveal-scale">
        <iframe
          src="https://www.nicky.photos/frame/slideshow?key=wXtF6f&autoStart=1&captions=1&navigation=1&playButton=0&randomize=1&speed=2&transition=fade&transitionSpeed=1"
          width="100%"
          height="400"
          class="sm:h-[500px] bg-stone-900"
          loading="lazy"
          title="Featured photos slideshow from nicky.photos"></iframe>
      </div>
    </Container>
  </section>

  <script src="@/scripts/reveal.ts"></script>
</BaseLayout>
