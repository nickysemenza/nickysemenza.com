---
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import Container from "../components/container.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";

const projects = [
  {
    emoji: "☁️",
    title: "Cloudflare",
    content: "Job since 2018, currently a senior software engineer."
  },
  {
    emoji: "🔨",
    title: "Kitchen Renovation",
    content: "Planning, project management, and construction. 2024.",
    link: {
      url: "/blog/kitchen-renovation/",
      text: "Photos and more"
    }
  },
  {
    emoji: "🥕",
    title: "Ingredient Parser",
    content: "Rust based ingredient parser. Started in 2021, an intermittent project.",
    link: {
      url: "https://ingredient.nickysemenza.com",
      text: "Demo site"
    }
  },
  {
    emoji: "📸",
    title: "Photography",
    content: "Photojournalism and freelance work from 2013 - 2018. Lately just travel and photos of my food.",
    link: {
      url: "https://nicky.photos",
      text: "View portfolio"
    }
  }
];

// Latest posts for the homepage
const posts = (await getCollection("blog"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <Container>
    <main class="prose prose-base mx-auto">
      <h1 class="font-bold mb-6 text-center">Recently working on</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        {projects.map((project) => (
          <ProjectCard
            emoji={project.emoji}
            title={project.title}
            content={project.content}
            link={project.link}
          />
        ))}
      </div>
      
      <div class="mt-8 mb-6">
        <h2 class="font-bold mb-3">Photos</h2>
        <iframe
          src="https://www.nicky.photos/frame/slideshow?key=wXtF6f&autoStart=1&captions=1&navigation=1&playButton=0&randomize=1&speed=2&transition=fade&transitionSpeed=1"
          width="100%"
          height="600"
          frameborder="0"
          class="rounded-lg shadow-lg"
          scrolling="no"
          loading="lazy"
          title="Featured photos slideshow from nicky.photos"></iframe>
      </div>

      {posts.length > 0 && (
        <section class="mt-10">
          <h2 class="font-bold mb-4">Latest posts</h2>
          <ul class="not-prose divide-y divide-gray-100">
            {posts.map((post) => (
              <li class="py-3">
                <a href={`/blog/${post.id}/`} class="flex items-baseline justify-between gap-4 group">
                  <span class="text-gray-900 group-hover:text-blue-700 transition-colors">{post.data.title}</span>
                  <span class="text-sm text-gray-500 whitespace-nowrap">
                    <FormattedDate date={post.data.pubDate} />
                  </span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      )}

      <div class="text-center mt-8">
        <a href="/blog" class="inline-block bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500" aria-label="View all blog posts">
          View all blog posts
        </a>
      </div>
    </main>
  </Container>
</BaseLayout>
