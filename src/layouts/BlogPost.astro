---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import { Picture } from "astro:assets";
import Container from "../components/Container.astro";
import TableOfContents from "../components/TableOfContents.astro";
import type { MarkdownHeading } from "astro";
import BaseLayout from "./BaseLayout.astro";

interface Props {
  post: CollectionEntry<"blog">;
  headings: MarkdownHeading[];
  readingTime: string;
}

const { post, headings, readingTime } = Astro.props;
const { title, description, pubDate, updatedDate, heroImage } = post.data;
---

<BaseLayout
  title={title}
  description={description || title}
  image={heroImage?.src}
>
  <!-- Post Header -->
  <section class="bg-gradient-to-b from-amber-50/80 to-stone-50 border-b border-amber-100/50 py-6 md:py-10">
    <Container>
      <div class="max-w-screen-md mx-auto text-center">
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold tracking-tight text-stone-800">
          {title}
        </h1>

        <div class="flex justify-center items-center gap-2 sm:gap-3 mt-3 md:mt-4 text-stone-500 text-sm">
          <FormattedDate date={pubDate} pill={false} />
          <span class="text-stone-300">Â·</span>
          <span>{readingTime}</span>
        </div>
      </div>
    </Container>
  </section>

  {
    heroImage && (
      <div class="relative z-0 max-w-screen-lg mx-auto overflow-hidden sm:px-4 lg:px-0">
        <Picture
          src={heroImage}
          widths={[400, 800, 1600]}
          alt="Thumbnail"
          loading="eager"
          class="w-full sm:rounded-lg"
          layout="full-width"
        />
      </div>
    )
  }
  <Container>
    <div class="flex gap-8 py-6 md:py-10">
      <article
        class="min-w-0 flex-1 prose prose-base prose-stone max-w-none prose-code:before:hidden prose-code:after:hidden dark:prose-invert prose-a:text-amber-700 hover:prose-a:text-amber-800 prose-headings:text-stone-800 prose-img:rounded-lg"
      >
        <!-- actual content in the slot -->
        <slot />
      </article>
      <aside class="hidden lg:block w-56 flex-shrink-0">
        <div class="sticky top-20">
          <TableOfContents headings={headings} levels={3} />
        </div>
      </aside>
    </div>
  </Container>
</BaseLayout>
